pipeline {
    agent any

    environment {
        DOCKER_HUB_CREDENTIALS = credentials('docker')
        DOCKER_IMAGE_NAME = 'mahaddevops/flaskapp'
    }

    stages {
        stage('Build') {
            steps {
                script {
                    // Pull the latest changes from the repository
                    checkout scm

                    // Build the Docker image
                    docker.build DOCKER_IMAGE_NAME
                }
            }
        }

        stage('Push to Docker Hub') {
            steps {
                script {
                    // Log in to Docker Hub using credentials
                    docker.withRegistry('https://index.docker.io/v1/', DOCKER_HUB_CREDENTIALS) {
                        // Push the Docker image to Docker Hub
                        docker.image(DOCKER_IMAGE_NAME).push('latest')
                    }
                }
            }
        }
    }

    post {
        success {
            // Send notification if the pipeline succeeds
            emailext subject: 'Jenkins Pipeline Success',
                      body: 'The Jenkins pipeline successfully built and pushed the Docker image.',
                      to: 'mahadrhat2@gmail.com'
        }
        failure {
            // Send notification if the pipeline fails
            emailext subject: 'Jenkins Pipeline Failed',
                      body: 'The Jenkins pipeline failed to build and push the Docker image.',
                      to: 'mahadrhat2@gmail.com'
        }
    }
}
